# ptxdist-log-parser

This package provides a tool to transform  a logfile generated by a _PTXdist_ build or a _make_ build into JSON format which can be read by Jenkins' [_Warnings NG_](https://plugins.jenkins.io/warnings-ng/) plugin.

The tool is written in _Python_ and has several modes of operation. To get help, enter a shell and type
```
./ptxdist_parser.py --help
```
To get more specific help for one of the modes, ask for specific help, for example
```
./ptxdist_parser.py collect --help
```


## Example invocation:
```
./ptxdist_parser.py -vv collect test-workspace/pfc/ptxproj/platform-wago-pfcXXX/logfile out/all_issues.json --buildfolder test-workspace/pfc
```
This example uses the default path mapping, which maps `/workspace/pfc` to "`.`". The source files will be looked up relative to the invocation location in `test-workspace/pfc`.


## Example transformation

This log file
```yaml
gbacktrace.c:177:5: warning: ignoring return value of 'fgets', declared with attribute warn_unused_result [-Wunused-result]
target: host-libcap.compile
make: Entering directory '/workspace/pfc/src'
cap_text.c:318:2: warning: ignoring return value of 'asprintf', declared with attribute warn_unused_result [-Wunused-result]
/workspace/pfc/src/cap_text.c:12:4: warning: abc [-Wabc]
```
will produce this JSON report
```JSON
[
    {
        "fileName": "test/res/src/gbacktrace.c",
        "lineStart": "177",
        "columnStart": "5",
        "category": "Warning:unused-result",
        "message": "ignoring return value of 'fgets', declared with attribute warn_unused_result [-Wunused-result]",
        "moduleName": "host-libcap"
    },
    {
        "fileName": "test/res/src/cap_text.c",
        "lineStart": "318",
        "columnStart": "2",
        "category": "Warning:unused-result",
        "message": "ignoring return value of 'asprintf', declared with attribute warn_unused_result [-Wunused-result]",
        "moduleName": "host-libcap"
    },
    {
        "fileName": "test/res/src/cap_text.c",
        "lineStart": "12",
        "columnStart": "4",
        "category": "Warning:abc",
        "message": "abc [-Wabc]",
        "moduleName": "host-libcap"
    }
]
```
